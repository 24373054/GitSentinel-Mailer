# 项目结构说明

```
github变更提示/
│
├── server/                          # 后端代码目录
│   ├── index.js                     # Express服务器主文件
│   │   ├── 创建Express应用
│   │   ├── 配置中间件（CORS、body-parser）
│   │   ├── 定义API路由
│   │   └── 启动服务器
│   │
│   ├── database.js                  # 数据库操作模块
│   │   ├── SQLite数据库初始化
│   │   ├── 创建数据表
│   │   ├── CRUD操作函数
│   │   └── 查询辅助函数
│   │
│   ├── monitorService.js           # GitHub监控服务
│   │   ├── 获取仓库最新提交
│   │   ├── 检查仓库变更
│   │   ├── 格式化提交信息
│   │   ├── 启动/停止监控
│   │   └── 定时任务管理
│   │
│   └── emailService.js             # 邮件发送服务
│       ├── Nodemailer配置
│       ├── 生成HTML邮件模板
│       ├── 发送变更通知
│       └── 测试邮件功能
│
├── client/                         # 前端代码目录
│   ├── public/                     # 静态资源
│   │   └── index.html             # HTML模板
│   │
│   ├── src/                       # React源代码
│   │   ├── components/            # React组件
│   │   │   ├── ProjectForm.js    # 项目表单组件
│   │   │   ├── ProjectForm.css   # 表单样式
│   │   │   ├── ProjectList.js    # 项目列表组件
│   │   │   └── ProjectList.css   # 列表样式
│   │   │
│   │   ├── services/              # API服务
│   │   │   └── api.js            # API调用封装
│   │   │
│   │   ├── App.js                # 主应用组件
│   │   ├── App.css               # 应用样式
│   │   ├── index.js              # React入口
│   │   └── index.css             # 全局样式
│   │
│   └── package.json              # 前端依赖配置
│
├── package.json                   # 后端依赖配置
├── .gitignore                    # Git忽略文件
├── README.md                     # 项目说明
├── 使用说明.md                    # 详细使用文档
├── 快速启动指南.txt               # 快速开始指南
├── 测试指南.md                    # 测试文档
├── 项目结构说明.md                # 本文件
│
├── install.bat                   # Windows安装脚本
├── start-dev.bat                # Windows开发环境启动脚本
├── start-server.bat             # Windows服务器启动脚本
│
└── github_monitor.db            # SQLite数据库文件（运行时生成）

```

## 核心文件详解

### 后端核心文件

#### 1. server/index.js
Express服务器主文件，负责：
- 创建和配置Express应用
- 定义RESTful API路由
- 处理HTTP请求和响应
- 服务静态文件（生产环境）

**主要API端点：**
- `GET /api/projects` - 获取所有项目
- `POST /api/projects` - 添加新项目
- `PUT /api/projects/:id` - 更新项目
- `DELETE /api/projects/:id` - 删除项目
- `POST /api/monitor/start/:id` - 启动监控
- `POST /api/monitor/stop/:id` - 停止监控
- `GET /api/monitor/status` - 获取监控状态

#### 2. server/database.js
数据库操作层，负责：
- 初始化SQLite数据库连接
- 创建和维护数据表结构
- 提供数据CRUD操作接口
- 数据格式转换

**数据表结构：**
```sql
CREATE TABLE projects (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  repo_url TEXT NOT NULL,
  email TEXT NOT NULL,
  is_monitoring INTEGER DEFAULT 0,
  last_commit_sha TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
)
```

#### 3. server/monitorService.js
GitHub监控服务核心，负责：
- 调用GitHub API获取仓库信息
- 检测仓库新提交
- 管理监控定时任务
- 触发邮件通知

**工作流程：**
1. 每5分钟执行一次检查
2. 获取仓库最新提交
3. 与上次记录的提交SHA对比
4. 如有新提交，调用邮件服务
5. 更新最后提交SHA记录

#### 4. server/emailService.js
邮件发送服务，负责：
- 配置SMTP连接
- 生成美观的HTML邮件模板
- 发送变更通知邮件
- 处理邮件发送错误

**邮件内容包括：**
- 仓库名称和链接
- 提交SHA和链接
- 提交信息
- 提交者
- 提交时间

### 前端核心文件

#### 1. client/src/App.js
React主应用组件，负责：
- 管理应用状态
- 协调子组件
- 处理业务逻辑
- 调用API服务

**主要状态：**
- `projects` - 项目列表
- `loading` - 加载状态
- `editingProject` - 编辑中的项目

#### 2. client/src/components/ProjectForm.js
项目表单组件，负责：
- 添加新项目
- 编辑现有项目
- 表单验证
- 用户输入处理

**表单字段：**
- 仓库地址（格式：owner/repo）
- 通知邮箱

#### 3. client/src/components/ProjectList.js
项目列表组件，负责：
- 显示所有项目
- 展示项目状态
- 提供操作按钮
- 处理用户操作

**显示信息：**
- 仓库地址（可点击链接）
- 通知邮箱
- 监控状态
- 最后提交SHA

**操作按钮：**
- 启动/停止监控
- 编辑项目
- 删除项目

#### 4. client/src/services/api.js
API服务层，负责：
- 封装所有API调用
- 处理HTTP请求
- 错误处理
- 统一错误提示

## 数据流向

### 添加项目流程
```
用户输入 → ProjectForm → App.handleAddProject 
→ api.addProject → 后端API → database.addProject 
→ SQLite数据库 → 响应返回 → 刷新列表
```

### 启动监控流程
```
点击按钮 → ProjectList → App.handleStartMonitoring 
→ api.startMonitoring → 后端API 
→ monitorService.startMonitoring → 启动定时任务 
→ database.updateMonitoringStatus → 更新数据库
```

### 监控检查流程
```
定时触发 → monitorService.checkRepositoryChanges 
→ GitHub API → 获取最新提交 → 对比SHA 
→ 发现新提交 → emailService.sendChangeNotification 
→ SMTP服务器 → 发送邮件 → 更新lastCommitSha
```

## 技术架构图

```
┌─────────────────────────────────────────────────────────┐
│                         前端层                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │  ProjectForm │  │  ProjectList │  │  API Service │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
│         └──────────────┬──────────────────┘             │
│                   ┌────▼────┐                           │
│                   │ App.js  │                           │
│                   └────┬────┘                           │
└────────────────────────┼──────────────────────────────┘
                         │ HTTP/REST API
┌────────────────────────▼──────────────────────────────┐
│                      后端层                             │
│  ┌──────────────────────────────────────────────────┐ │
│  │           Express Server (index.js)              │ │
│  └──────────────────────────────────────────────────┘ │
│         │              │              │                │
│    ┌────▼────┐   ┌────▼────┐   ┌────▼─────────┐      │
│    │Database │   │ Monitor │   │Email Service│       │
│    │ Service │   │ Service │   │             │       │
│    └────┬────┘   └────┬────┘   └─────────────┘      │
└─────────┼─────────────┼─────────────────────────────┘
          │             │
     ┌────▼────┐   ┌────▼──────┐
     │ SQLite  │   │  GitHub   │
     │Database │   │    API    │
     └─────────┘   └───────────┘
```

## 关键技术点

### 1. 定时任务管理
使用JavaScript的`setInterval`实现定时检查：
```javascript
const intervalId = setInterval(() => {
  checkRepositoryChanges(project);
}, MONITOR_INTERVAL);
```

### 2. 监控状态恢复
服务器启动时自动恢复监控：
```javascript
setTimeout(restoreMonitoring, 2000);
```

### 3. 数据持久化
使用SQLite保证数据持久化和跨平台兼容性

### 4. 前后端分离
开发环境：前后端独立运行，使用代理
生产环境：后端提供静态文件服务

### 5. 响应式设计
使用CSS Grid和Flexbox实现自适应布局

## 配置说明

### 后端配置
- 端口：5000（可在server/index.js修改）
- 监控间隔：5分钟（可在monitorService.js修改）
- 数据库文件：github_monitor.db

### 前端配置
- 开发端口：3000
- API代理：http://localhost:5000
- 生产构建：client/build/

### 邮件配置
- SMTP服务器：smtp.qq.com
- 端口：587
- 发件邮箱：2315766973@qq.com

## 扩展建议

### 功能扩展
1. 添加GitHub Token认证（提高API限额）
2. 支持监控私有仓库
3. 添加多邮箱通知
4. 自定义监控间隔
5. 监控历史记录
6. 统计图表展示

### 技术优化
1. 使用TypeScript增强类型安全
2. 添加单元测试和集成测试
3. 使用Redis缓存GitHub API响应
4. 使用消息队列处理邮件发送
5. 添加日志系统
6. Docker容器化部署

### 界面优化
1. 添加深色模式
2. 国际化支持
3. 更丰富的动画效果
4. 移动端优化
5. 添加通知音效

## 维护指南

### 日常维护
- 定期检查数据库大小
- 监控服务器资源使用
- 查看错误日志
- 更新依赖包

### 故障排查
1. 检查服务器日志
2. 验证GitHub API可访问性
3. 测试邮件发送功能
4. 检查数据库完整性

### 备份建议
- 定期备份github_monitor.db
- 导出项目配置
- 保存错误日志

---

最后更新：2025-11-01
版本：v1.0.0

