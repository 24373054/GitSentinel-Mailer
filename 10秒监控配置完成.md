# ✅ 10秒监控间隔配置完成

## 已完成的修改

### 1. ✅ 环境变量加载
- 在 `server/index.js` 中添加了 `dotenv` 配置加载
- 启动时会自动读取 `.env` 文件中的 GitHub Token

### 2. ✅ 监控间隔调整
- 从 10分钟 改为 **10秒**
- 位置：`server/monitorService.js` 第23行

### 3. ✅ 速率限制优化
- 使用Token时：初始限制5000次/小时
- 未使用Token时：初始限制60次/小时
- 动态警告阈值：剩余10%时发出警告

### 4. ✅ Token状态显示
- 服务器启动时显示Token加载状态
- 首次API请求时确认Token使用情况
- 实时显示剩余请求次数

## 您的配置

### .env 文件内容
```env
GITHUB_TOKEN=your_github_token_here
```

> **⚠️ 重要**: 请将 `your_github_token_here` 替换为您自己的GitHub Personal Access Token

### 位置
项目根目录（与 `package.json` 同级）

## 🚀 启动步骤

### 步骤1：验证配置（可选）

```bash
node 验证Token配置.js
```

预期输出：
```
✅ GitHub Token 已配置
   Token: ghp_QO5BhxC...0VQ9
   长度: 40 字符
   速率限制: 5000次/小时

🎉 配置正确！您可以使用10秒监控间隔。
```

### 步骤2：启动服务

```bash
# 停止当前服务（如果正在运行）
# 按 Ctrl+C

# 重新启动
npm run dev
```

### 步骤3：确认Token已加载

启动后查看控制台输出，应该看到：

```
服务器运行在端口 5000
✅ GitHub Token 已加载，速率限制：5000次/小时
数据库连接成功
数据表初始化成功
```

如果看到 `⚠️ 未检测到GitHub Token`，请检查 `.env` 文件。

### 步骤4：开始监控

在前端界面启动任意项目监控，观察后端日志：

```
🔑 使用GitHub Token认证，速率限制：5000次/小时
🔍 正在检查项目 xxx/yyy 的变更... (剩余请求: 4999)
✅ 初始化项目 xxx/yyy，记录最新提交: abc1234
```

## 📊 监控效果

### 当前配置
- **监控间隔**: 10秒
- **速率限制**: 5000次/小时
- **每小时请求数**: 360次（每10秒1次 × 6次/分钟 × 60分钟）
- **安全余量**: 充足（4640次余量）

### 支持监控数量
- **单项目**: ✅ 完全安全（每小时360次）
- **5个项目**: ✅ 安全（每小时1800次）
- **10个项目**: ✅ 可行（每小时3600次）
- **15个项目**: ⚠️ 接近上限（每小时5400次，需注意）

## 🔍 日志说明

### 正常运行
```
🔍 正在检查项目 xxx/yyy 的变更... (剩余请求: 4995)
✓ 项目 xxx/yyy 暂无新提交
```

### 检测到新提交
```
🎉 检测到项目 xxx/yyy 有新提交！
📧 已向 your@email.com 发送 1 个新提交的通知
```

### 速率限制警告（剩余<500次时）
```
⚠️ GitHub API速率限制警告：剩余 450/5000 次请求，将在 2025-01-01 12:00:00 重置
```

### Token未加载
```
⚠️ 未检测到GitHub Token，速率限制：60次/小时
```

## ❓ 常见问题

### Q: Token未被识别？

**检查清单：**
1. `.env` 文件在项目根目录（与 `package.json` 同级）
2. 文件名正确：`.env`（不是 `env.txt` 或其他）
3. 内容格式正确：`GITHUB_TOKEN=xxx`（没有空格、引号）
4. 已重启服务器

### Q: 如何确认Token有效？

运行验证脚本：
```bash
node 验证Token配置.js
```

或访问GitHub检查Token状态：
https://github.com/settings/tokens

### Q: Token权限不足？

您的Token已开放全部权限，足够使用。如需调整：
1. 访问 https://github.com/settings/tokens
2. 点击您的Token
3. 勾选 `repo` (访问仓库)
4. 保存更改

### Q: 想改回较长间隔？

编辑 `server/monitorService.js` 第23行：
```javascript
// 10秒
const MONITOR_INTERVAL = 10 * 1000;

// 改为1分钟
const MONITOR_INTERVAL = 60 * 1000;

// 改为5分钟
const MONITOR_INTERVAL = 5 * 60 * 1000;
```

## 📈 性能建议

### 最佳实践
1. **1-3个项目**: 10秒间隔完美
2. **4-8个项目**: 10-15秒间隔推荐
3. **9-12个项目**: 15-20秒间隔较安全
4. **13+个项目**: 考虑30秒或更长

### 监控活跃仓库
- 活跃仓库（每天多次提交）：可用10秒
- 普通仓库（每天1-2次提交）：建议1-5分钟
- 低频仓库（每周几次提交）：建议10-30分钟

## 🎯 现在可以使用了！

配置已完成，请按照"启动步骤"重新启动服务，即可享受10秒监控间隔！

---

**配置时间**: 完成
**监控间隔**: 10秒
**速率限制**: 5000次/小时（已认证）
**状态**: ✅ 就绪

