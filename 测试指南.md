# 测试指南

## 系统测试清单

### 1. 环境准备测试

- [ ] Node.js 已安装（v14+）
- [ ] 运行 `install.bat` 成功安装依赖
- [ ] 检查 `node_modules` 文件夹是否创建
- [ ] 检查 `client/node_modules` 文件夹是否创建

### 2. 后端服务测试

#### 启动测试
```bash
npm run server
```

预期结果：
- ✅ 控制台显示 "服务器运行在端口 5000"
- ✅ 控制台显示 "数据库连接成功"
- ✅ 控制台显示 "数据表初始化成功"

#### API测试

使用浏览器或Postman测试：

**获取项目列表**
```
GET http://localhost:5000/api/projects
```
预期：返回空数组 `[]`

**添加项目**
```
POST http://localhost:5000/api/projects
Content-Type: application/json

{
  "repoUrl": "facebook/react",
  "email": "your@email.com"
}
```
预期：返回成功消息和项目ID

### 3. 前端界面测试

#### 启动测试
```bash
cd client
npm start
```

预期结果：
- ✅ 自动打开浏览器访问 http://localhost:3000
- ✅ 显示完整的界面布局
- ✅ 无控制台错误

#### 界面功能测试

**添加项目测试**
1. 输入仓库地址：`facebook/react`
2. 输入邮箱：您的真实邮箱
3. 点击"添加项目"
4. 预期：
   - ✅ 弹出"项目添加成功"提示
   - ✅ 项目出现在列表中
   - ✅ 显示正确的仓库地址和邮箱

**表单验证测试**
1. 空表单提交
   - 预期：❌ 提示"请填写所有字段"

2. 错误的仓库格式（如 `https://github.com/facebook/react`）
   - 预期：❌ 提示"仓库地址格式错误"

3. 错误的邮箱格式（如 `invalid-email`）
   - 预期：❌ 提示"邮箱格式错误"

**监控功能测试**
1. 点击"启动监控"
   - 预期：
     - ✅ 按钮变为"停止监控"
     - ✅ 状态标签变为"🟢 监控中"
     - ✅ 后端控制台显示监控启动信息
     - ✅ 控制台显示初始化提交SHA

2. 点击"停止监控"
   - 预期：
     - ✅ 按钮变为"启动监控"
     - ✅ 状态标签变为"⚪ 已停止"
     - ✅ 后端控制台显示停止监控信息

**编辑功能测试**
1. 停止监控后，点击"编辑"
   - 预期：
     - ✅ 表单填充当前项目数据
     - ✅ 表单标题变为"编辑项目"
     - ✅ 按钮变为"保存修改"

2. 修改信息后点击"保存修改"
   - 预期：
     - ✅ 弹出"项目更新成功"
     - ✅ 列表显示更新后的信息

3. 点击"取消"
   - 预期：
     - ✅ 表单清空
     - ✅ 回到添加模式

**删除功能测试**
1. 监控中的项目点击"删除"
   - 预期：❌ 按钮禁用（灰色）

2. 停止监控后点击"删除"
   - 预期：
     - ✅ 弹出确认对话框
     - ✅ 确认后项目从列表移除

### 4. 监控服务测试

#### 测试步骤

1. 添加一个活跃的仓库（如 `facebook/react`）
2. 启动监控
3. 查看后端控制台输出

预期输出：
```
开始监控项目: facebook/react
初始化项目 facebook/react，记录最新提交: abc1234
正在检查项目 facebook/react 的变更...
```

#### 模拟新提交测试

由于无法真实触发GitHub提交，可以通过以下方式测试：

1. 在 `server/monitorService.js` 中临时修改 `MONITOR_INTERVAL` 为 30000（30秒）
2. 监控一个最近有提交的活跃仓库
3. 等待下一次检查周期
4. 查看是否检测到新提交并发送邮件

### 5. 邮件发送测试

#### 手动测试邮件服务

在 `server/emailService.js` 中有 `sendTestEmail` 函数，可以创建测试脚本：

创建 `test-email.js`:
```javascript
const emailService = require('./server/emailService');

const testEmail = 'your@email.com'; // 替换为您的邮箱

emailService.sendTestEmail(testEmail)
  .then(() => {
    console.log('测试邮件发送成功！');
    process.exit(0);
  })
  .catch(err => {
    console.error('测试邮件发送失败:', err);
    process.exit(1);
  });
```

运行：
```bash
node test-email.js
```

预期：
- ✅ 控制台显示"测试邮件发送成功"
- ✅ 邮箱收到测试邮件

### 6. 数据库测试

检查数据库文件：
- ✅ 根目录生成 `github_monitor.db` 文件
- ✅ 数据正确保存和读取
- ✅ 重启服务器后数据仍存在

### 7. 监控恢复测试

1. 启动一个项目的监控
2. 停止服务器（Ctrl+C）
3. 重新启动服务器
4. 检查后端控制台

预期：
- ✅ 显示"恢复监控: xxx/xxx"
- ✅ 监控自动继续运行

### 8. 完整流程测试

#### 场景：监控一个仓库并接收通知

1. **准备**
   - 启动系统（前后端）
   - 确保网络连接正常

2. **添加项目**
   - 仓库：`facebook/react`（或其他活跃仓库）
   - 邮箱：您的真实邮箱

3. **启动监控**
   - 点击"启动监控"
   - 等待系统初始化

4. **等待通知**
   - 修改监控间隔为1分钟（方便测试）
   - 等待几分钟
   - 检查是否收到邮件（如果有新提交）

5. **验证邮件内容**
   - ✅ 邮件标题正确
   - ✅ 包含仓库名称
   - ✅ 包含提交信息
   - ✅ 链接可点击
   - ✅ 格式美观

### 9. 异常处理测试

**网络错误测试**
1. 断开网络连接
2. 启动监控
3. 预期：
   - ✅ 控制台显示错误信息
   - ✅ 系统不崩溃
   - ✅ 其他功能正常

**错误的仓库地址**
1. 添加不存在的仓库（如 `xxx/yyy`）
2. 启动监控
3. 预期：
   - ✅ 控制台显示错误信息
   - ✅ 不影响其他项目

**邮件发送失败**
1. 使用无效的邮箱地址
2. 触发邮件发送
3. 预期：
   - ✅ 控制台显示错误
   - ✅ 监控继续运行

### 10. 性能测试

**多项目同时监控**
1. 添加3-5个项目
2. 全部启动监控
3. 观察系统表现

预期：
- ✅ 所有项目正常监控
- ✅ CPU和内存使用合理
- ✅ 响应速度正常

## 测试报告模板

```
测试日期：____年__月__日
测试人员：________
系统版本：v1.0.0

【环境信息】
- Node.js版本：______
- 操作系统：______
- 浏览器：______

【测试结果】
✅ 后端服务启动正常
✅ 前端界面显示正常
✅ 添加项目功能正常
✅ 监控启动/停止正常
✅ 编辑项目功能正常
✅ 删除项目功能正常
✅ 数据持久化正常
✅ 监控恢复功能正常
✅ 邮件发送功能正常

【发现的问题】
无 / 列出问题

【备注】
_______________________
```

## 调试技巧

### 查看日志
- 后端日志：查看运行 `npm run server` 的终端
- 前端日志：按F12打开浏览器开发者工具

### 常见问题解决

1. **端口被占用**
   - 修改 `server/index.js` 中的 PORT
   - 或关闭占用端口的程序

2. **依赖安装失败**
   - 删除 `node_modules` 文件夹
   - 重新运行 `npm install`

3. **数据库错误**
   - 删除 `github_monitor.db` 文件
   - 重启服务器重新初始化

4. **邮件发送失败**
   - 检查网络连接
   - 确认邮箱配置正确
   - 查看QQ邮箱是否开启SMTP服务

## 建议测试顺序

1. ✅ 环境准备
2. ✅ 后端API测试
3. ✅ 前端界面测试
4. ✅ 基本功能测试（增删改查）
5. ✅ 监控功能测试
6. ✅ 邮件发送测试
7. ✅ 异常处理测试
8. ✅ 完整流程测试

祝测试顺利！🎉

