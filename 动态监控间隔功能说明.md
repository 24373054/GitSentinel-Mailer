# 🎛️ 动态监控间隔功能说明

## ✅ 功能已完成

您现在可以在前端界面直接调整监控间隔，无需修改代码！

## 🎯 新增功能

### 1. 监控设置面板
- 📊 实时显示当前监控间隔
- ⚙️ 可自定义设置任意间隔（5秒-1小时）
- 🔘 快捷按钮：5秒、10秒、30秒、1分钟、5分钟、10分钟
- 📈 智能显示使用量预测和安全建议

### 2. 后端API
- `GET /api/monitor/interval` - 获取当前监控间隔配置
- `POST /api/monitor/interval` - 设置新的监控间隔

### 3. 智能提示
- ✅ 显示GitHub Token状态
- 📊 显示速率限制信息
- ⚠️ 警告过高的请求频率
- 💡 提供使用建议

## 🚀 使用方法

### 步骤1：启动服务

```bash
# 确保已创建.env文件并配置Token
npm run dev
```

### 步骤2：打开前端界面

访问 http://localhost:3000

### 步骤3：调整监控间隔

在页面顶部的"⚙️ 监控间隔设置"面板中：

1. **使用快捷按钮**：
   - 点击预设按钮（5秒、10秒等）
   - 点击"💾 应用设置"

2. **自定义输入**：
   - 在输入框中输入秒数（5-3600）
   - 点击"💾 应用设置"

3. **查看效果**：
   - 设置会立即生效
   - 所有监控中的项目会自动重启应用新间隔
   - 后端控制台会显示更新信息

## 📊 界面说明

### 当前状态区域
```
📊 当前状态
├─ GitHub Token: ✅ 已配置 / ⚠️ 未配置
├─ 速率限制: 5000次/小时 / 60次/小时
├─ 监控项目: X个
└─ 推荐最小间隔: 5秒 / 60秒
```

### 预计使用量区域
```
📈 预计使用量
├─ 每小时请求数: XXX次
└─ 安全余量: XXX次
```

### 智能建议
系统会根据您的配置自动显示：
- ✅ 安全提示：配置合理
- ⚠️ 警告提示：接近限制
- ❌ 危险提示：超出限制
- 💡 使用建议：优化方案

## 🎨 界面预览

```
┌─────────────────────────────────────────┐
│   ⚙️ 监控间隔设置                        │
│   当前间隔：10秒                         │
├─────────────────────────────────────────┤
│   监控间隔（秒）                         │
│   [    10     ]                         │
│                                         │
│   [5秒] [10秒] [30秒]                   │
│   [1分钟] [5分钟] [10分钟]               │
│                                         │
│   [     💾 应用设置     ]                │
├─────────────────────────────────────────┤
│   📊 当前状态                            │
│   GitHub Token: ✅ 已配置               │
│   速率限制: 5000次/小时                  │
│   监控项目: 1个                          │
│   推荐最小间隔: 5秒                      │
│                                         │
│   📈 预计使用量                          │
│   每小时请求数: 360次                    │
│   安全余量: 4640次                       │
│                                         │
│   💡 使用建议                            │
│   ✅ 当前设置安全，使用量在合理范围内     │
└─────────────────────────────────────────┘
```

## 🔍 监控间隔建议

### 根据Token状态

| Token状态 | 推荐最小间隔 | 说明 |
|----------|-------------|------|
| ✅ 已配置 | 5秒 | 速率限制5000次/小时 |
| ❌ 未配置 | 60秒 | 速率限制60次/小时 |

### 根据项目数量（使用Token）

| 项目数 | 推荐间隔 | 每小时请求 |
|-------|---------|-----------|
| 1-3个 | 5-10秒 | 360-1080 |
| 4-8个 | 10-15秒 | 960-1920 |
| 9-12个 | 15-20秒 | 1080-2880 |
| 13+个 | 30秒+ | 视情况而定 |

### 根据仓库活跃度

| 仓库类型 | 推荐间隔 | 说明 |
|---------|---------|------|
| 高频更新 | 5-30秒 | 每天多次提交 |
| 正常活跃 | 1-5分钟 | 每天1-5次提交 |
| 低频更新 | 5-30分钟 | 每周几次提交 |

## ⚠️ 重要提示

### 限制说明
- **最小间隔**：5秒（防止过于频繁）
- **最大间隔**：3600秒（1小时）
- **验证检查**：系统会自动验证输入的有效性

### 安全建议
1. **未配置Token**：强烈建议间隔≥60秒
2. **接近限制**：系统会显示警告，建议增加间隔
3. **超出限制**：必须立即增加间隔，否则会触发403错误

### 实时生效
- 修改间隔后，所有监控中的项目会**立即重启**
- 新间隔会**马上应用**到所有项目
- 不影响数据库中的项目配置

## 🛠️ 技术实现

### 后端
- 动态修改`MONITOR_INTERVAL`变量
- 自动重启所有监控任务
- 保持项目状态和数据

### 前端
- React组件：`MonitorSettings`
- 实时计算使用量
- 智能安全提示
- 美观的UI设计

### API
```javascript
// 获取当前间隔
GET /api/monitor/interval
返回: {
  seconds: 10,
  milliseconds: 10000,
  hasToken: true,
  rateLimit: 5000,
  recommendedMin: 5,
  activeProjects: 1
}

// 设置新间隔
POST /api/monitor/interval
请求: { seconds: 30 }
返回: {
  message: "监控间隔已更新",
  oldInterval: 10,
  newInterval: 30,
  restartedProjects: 1
}
```

## 📝 使用示例

### 场景1：快速测试（使用Token）
```
1. 设置间隔：10秒
2. 添加1个测试项目
3. 启动监控
4. 每10秒检查一次
```

### 场景2：监控多个项目
```
1. 添加5个项目
2. 设置间隔：15秒
3. 查看预计使用：240次/小时
4. 确认在安全范围内
5. 全部启动监控
```

### 场景3：未配置Token
```
1. 系统显示：⚠️ 未配置Token
2. 推荐最小间隔：60秒
3. 设置间隔：120秒（2分钟）
4. 每小时仅30次请求
5. 安全监控
```

## 🎉 优势特点

### 1. 灵活性
- ✅ 随时调整，无需重启
- ✅ 所有项目统一管理
- ✅ 支持个性化配置

### 2. 安全性
- ✅ 智能计算使用量
- ✅ 实时警告提示
- ✅ 防止超出限制

### 3. 易用性
- ✅ 直观的图形界面
- ✅ 快捷预设按钮
- ✅ 详细的状态显示

### 4. 智能化
- ✅ 自动检测Token
- ✅ 动态调整建议
- ✅ 实时计算余量

## 🔄 更新流程

当您修改监控间隔时：

```
1. 前端输入新间隔 (例如: 30秒)
   ↓
2. 调用API: POST /api/monitor/interval
   ↓
3. 后端更新MONITOR_INTERVAL变量
   ↓
4. 停止所有当前监控任务
   ↓
5. 使用新间隔重新启动所有任务
   ↓
6. 返回更新结果
   ↓
7. 前端显示成功消息
   ↓
8. 新间隔立即生效！
```

## 📌 常见问题

### Q: 修改间隔会丢失数据吗？
A: 不会。只是重启监控任务，所有项目配置和提交记录都保留。

### Q: 可以为不同项目设置不同间隔吗？
A: 当前版本所有项目使用统一间隔。未来可能支持单独设置。

### Q: 修改间隔后需要重启服务吗？
A: 不需要。修改后立即生效。

### Q: 间隔太短会怎样？
A: 系统会警告并可能触发GitHub速率限制。建议遵循推荐值。

### Q: 刷新页面后设置会保留吗？
A: 会保留。设置存储在后端内存中，除非重启服务器。

## 💡 最佳实践

1. **首次使用**：先设置较大间隔（如1分钟），观察效果
2. **逐步调整**：根据需求慢慢缩短间隔
3. **监控余量**：经常查看"安全余量"，保持充足
4. **配置Token**：强烈建议配置，获得更高限制
5. **合理设置**：不要盲目追求短间隔，够用就好

## 🎊 开始使用

现在就重启服务，体验全新的动态监控间隔功能吧！

```bash
npm run dev
```

访问 http://localhost:3000，在顶部找到"⚙️ 监控间隔设置"面板！

---

**功能版本**: v2.0
**最后更新**: 2025-11-02
**状态**: ✅ 已完成并测试

